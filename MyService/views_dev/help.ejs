<% include _public/header %>
<table>
    <thead>
    <tr>
        <td>url</td>
        <td>method</td>
        <td>data</td>
    </tr>
    </thead>
    <tbody>
    <% restList.forEach(function (t) { %>
    <tr>
        <td><a name="url" href="<%= t.method == 'post' ? 'javascript:;' : t.exampleRequest || t.url %>"
                <%= t.method == 'post' ? '' : 'target=_blank' %>
               data-url="<%= t.url %>"
               data-method="<%= t.method %>"
               data-req="<%= t.method == 'post' && t.exampleRequest ? t.exampleRequest:'' %>">
                <%= t.url %></a>
        </td>
        <td>[<%= t.method %>]</td>
        <td>
            <textarea name="exampleRequest"><%= t.method == 'post' && t.exampleRequest ? t.exampleRequest:'' %></textarea>
        </td>
    </tr>
    <% }) %>
    </tbody>
</table>
<% include _public/footer %>
<script type="text/javascript">
    $(function () {
        $(document).on('click', '[name=url][data-method=post]', function () {
            var dom = $(this);
            var row = dom.closest('tr');
            var req = $.trim(row.find('[name=exampleRequest]').val());
            var url = dom.attr('data-url');
            if (!req) req = {};
            if (typeof req == 'string')
                req = JSON.parse(req);
            var headers = {};
            if (url == '/login') {
                var userInfo = $.cookie(config.cacheKey.userInfo);
                if(!userInfo){
                    userInfo = extend.guid();
                    $.cookie(config.cacheKey.userInfo, userInfo, { expires: 1 });
                }
                var token = extend.createToken(req.userName + $.md5(req.pwd) + JSON.stringify(req));
                headers = {
                    'User-Name': 'user',
                    'Token': token,
                };
            }else if(url == '/signUp'){
                req.pwd = $.md5(req.pwd);
            }
            var reqStr = req;
            if(typeof reqStr != 'string');
                reqStr = JSON.stringify(reqStr);
            extend.ajax({
                url: url,
                data: reqStr,
                headers: headers,
            }).then(function (t) {
                console.log(t)
            }).fail(function (e) {
                console.log(e)
            });
        });
    });
</script>
